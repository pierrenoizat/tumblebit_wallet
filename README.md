bitcoinscri.pt
================

[![Deploy to Heroku](https://www.herokucdn.com/deploy/button.png)](https://heroku.com/deploy)

This application allows users to create and run simple bitcoin scripts using new opcodes such as CLTV and/or CSV.

Problems? Issues?
-----------

Need help? Contact me at pierre dot noizat at paymium dot com

If the application doesn't work as expected, please [report an issue](https://github.com/RailsApps/rails_apps_composer/issues)
and include the diagnostics.

Ruby on Rails
-------------

This application requires:

- Ruby 2.2.0
- Rails 4.2.0
- btcruby

Getting Started
---------------
To create a new binary tree, upload a CSV file of your account list.
Each account is on a new line with: name, credit

Make sure to NOT add an empty line at the end of your file as this would cause the line count to be incremented, messing up the computation of the tree.

A random nonce generated by the application is saved and associated with each account: 
this nonce is hashed with the account name and credit to generate an account hash while preserving the privacy of the account owner.

This nonce can be used also as a secret access key for the user to retrieve his/her account securely in a published hash tree.

Each account is then represented by a leaf in the tree with a SHA256 hash of the following string: "name|credit|nonce"


In RoR, the hash is calculated in app/models/leaf_node.rb_ like so:

    hash = OpenSSL::Digest::SHA256.new.digest("#{self.name}|#{self.credit.to_s}|#{self.nonce}")
    leaf_hash = hash.unpack('H*').first      # hash converted from binary to hexadecimal string


Leaves are paired to form a binary tree.
An interior node hash is calculated from the hashes of its left and right children nodes.

The parent node hash is a SHA256 hash of the following string: "sum|left|right"


The parent node sum is calculated simply by adding the sums of the two children nodes.

As a result, the root node sum can be checked by adding all the account balance.

Two leaf hashes are combined to compute an interior node hash like so:


    string = "#{@node.sum.to_s}|#{@node.left}|#{@node.right}"
    hash = OpenSSL::Digest::SHA256.new.digest(string)
    @node.node_hash = hash.unpack('H*').first

If there is an odd number of leaves, one leaf is randomly selected to be replicated as an interior node.
This particular interior node has this leaf as its only child.

Likewise, at any given height h in the tree, if there is an odd number of interior nodes at that height, a node is selected to be replicated as an interior node of height h+1.
This particular interior node has this node as its only child.

License
-------
Â© Paymium 2011-2016 Released under the [MIT license](http://opensource.org/licenses/mit-license.php)